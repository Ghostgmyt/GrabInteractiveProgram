#include <iostream>
#include <cmath>    // for round
using namespace std;

int main() {
    cout << "=== GRAB Fare & ETA Estimator ===\n";

    // ---------- Variables ----------
    double distance;    // km [0.5..100]
    int hour;           // 0..23
    int demand;         // 1..10
    int supply;         // 1..10
    int tier;           // 1=Basic, 2=Silver, 3=Gold
    int service;        // 1=Standard, 2=Pool
    double toll = 0.0;  // toll fee, default 0

    // ---------- "Questions" and answers ----------
    cout << "Enter trip distance in km (0.5 - 100): ";
    cin >> distance;
    cout << "Enter the hour of the day (0 - 23): ";
    cin >> hour;
    cout << "On a scale of 1 to 10, how high is the demand? ";
    cin >> demand;
    cout << "On a scale of 1 to 10, how many drivers (supply) are available? ";
    cin >> supply;
    cout << "Choose your tier (1 = Basic, 2 = Silver, 3 = Gold): ";
    cin >> tier;
    cout << "Choose service type (1 = Standard, 2 = Pool): ";
    cin >> service;

    // ask if tolls apply
    char tollChoice;
    cout << "Are there any toll charges? (y/n): ";
    cin >> tollChoice;
    if (tollChoice == 'y' || tollChoice == 'Y') {
        cout << "Enter toll charges (RM): ";
        cin >> toll;
        if (toll < 0) toll = 0.0; // basic guard
    }

    // ---------- Basic validation ----------
    if (distance < 0.5) distance = 0.5;
    if (distance > 100.0) distance = 100.0;
    if (hour < 0) hour = 0; if (hour > 23) hour = 23;
    if (demand < 1) demand = 1; if (demand > 10) demand = 10;
    if (supply <= 0) supply = 1; if (supply > 10) supply = 10;
    if (tier < 1) tier = 1; if (tier > 3) tier = 3;
    if (service < 1) service = 1; if (service > 2) service = 2;

    // ---------- Logic ----------
    // rates
    double base, perKm, perMin;
    if (service == 1) { base = 3.0; perKm = 1.5; perMin = 0.3; } // Standard
    else              { base = 2.0; perKm = 1.0; perMin = 0.2; } // Pool

    // ETA (minutes) with slower speed at peaks
    double speed = 32.0;
    if ((hour >= 7 && hour <= 9) || (hour >= 17 && hour <= 20)) speed = 22.0;
    double eta = (distance / speed) * 60.0;
    if (eta < 5.0) eta = 5.0;

    // surge
    double ratio = (double)demand / (double)supply;
    double surge = 1.0;
    if (ratio > 1.0) surge += (ratio - 1.0);
    if ((hour >= 7 && hour <= 9) || (hour >= 17 && hour <= 20)) surge += 0.25;
    if (surge > 3.5) surge = 3.5;

    // tier discount
    double disc = 0.0;
    if (tier == 2) disc = 0.07;
    else if (tier == 3) disc = 0.15;

    // fare calculation
    double subtotal   = (base + perKm * distance + perMin * eta) * surge;
    double discounted = subtotal * (1.0 - disc);

    // round ride fare only
    int rideFare = (int)round(discounted);

    // final fare = ride fare + toll (toll may have decimals)
    double finalFare = rideFare + toll;

    // ---------- Output ----------
    cout << "\n--- Fare Result ---\n";
    cout << "Service       : " << (service == 1 ? "Standard" : "Pool") << "\n";
    cout << "Distance (km) : " << distance << "\n";
    cout << "ETA (minutes) : " << (int)round(eta) << "\n";
    cout << "Surge         : x" << surge << "\n";
    cout << "Tier Discount : " << (int)(disc*100) << "%\n";
    cout << "Ride Fare     : RM " << rideFare << "\n";
    if (toll > 0) {
        cout << "Toll Charges  : RM " << toll << "\n";
    }
    cout << "Estimated Fare: RM " << finalFare << "\n";

    // tip
    if (surge >= 2.0 && distance <= 8.0 && service == 1) {
        cout << "Tip: POOL may be cheaper now due to high surge on a short trip.\n";
    } else if (service == 2) {
        cout << "Note: STANDARD may be faster if you're in a hurry.\n";
    }

    return 0;
}
